/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.dtl.contrib.dijit"]){dojo._hasResource["dojox.dtl.contrib.dijit"]=true;dojo.provide("dojox.dtl.contrib.dijit");dojo.require("dojox.dtl.dom");dojo.require("dojo.parser");(function(){var dd=dojox.dtl;var _1=dd.contrib.dijit;_1.AttachNode=dojo.extend(function(_2,_3){this._keys=_2;this._object=_3;},{render:function $D1Z_(_4,_5){if(!this._rendered){this._rendered=true;for(var i=0,_6;_6=this._keys[i];i++){_4.getThis()[_6]=this._object||_5.getParent();}}return _5;},unrender:function $D1a_(_7,_8){if(this._rendered){this._rendered=false;for(var i=0,_9;_9=this._keys[i];i++){if(_7.getThis()[_9]===(this._object||_8.getParent())){delete _7.getThis()[_9];}}}return _8;},clone:function $D1b_(_a){return new this.constructor(this._keys,this._object);}});_1.EventNode=dojo.extend(function(_b,_c){this._command=_b;var _d,_e=_b.split(/\s*,\s*/);var _f=dojo.trim;var _10=[];var fns=[];while(_d=_e.pop()){if(_d){var fn=null;if(_d.indexOf(":")!=-1){var _11=_d.split(":");_d=_f(_11[0]);fn=_f(_11.slice(1).join(":"));}else{_d=_f(_d);}if(!fn){fn=_d;}_10.push(_d);fns.push(fn);}}this._types=_10;this._fns=fns;this._object=_c;this._rendered=[];},{_clear:false,render:function $D1c_(_12,_13){for(var i=0,_14;_14=this._types[i];i++){if(!this._clear&&!this._object){_13.getParent()[_14]=null;}var fn=this._fns[i];var _15;if(fn.indexOf(" ")!=-1){if(this._rendered[i]){dojo.disconnect(this._rendered[i]);this._rendered[i]=false;}_15=dojo.map(fn.split(" ").slice(1),function(_16){return new dd._Filter(_16).resolve(_12);});fn=fn.split(" ",2)[0];}if(!this._rendered[i]){if(!this._object){this._rendered[i]=_13.addEvent(_12,_14,fn,_15);}else{this._rendered[i]=dojo.connect(this._object,_14,_12.getThis(),fn);}}}this._clear=true;return _13;},unrender:function $D1d_(_17,_18){while(this._rendered.length){dojo.disconnect(this._rendered.pop());}return _18;},clone:function $D1e_(){return new this.constructor(this._command,this._object);}});function cloneNode(n1){var n2=n1.cloneNode(true);if(dojo.isIE){dojo.query("script",n2).forEach("item.text = this[index].text;",dojo.query("script",n1));}return n2;};_1.DojoTypeNode=dojo.extend(function(_19,_1a){this._node=_19;this._parsed=_1a;var _1b=_19.getAttribute("dojoAttachEvent");if(_1b){this._events=new _1.EventNode(dojo.trim(_1b));}var _1c=_19.getAttribute("dojoAttachPoint");if(_1c){this._attach=new _1.AttachNode(dojo.trim(_1c).split(/\s*,\s*/));}if(!_1a){this._dijit=dojo.parser.instantiate([cloneNode(_19)])[0];}else{_19=cloneNode(_19);var old=_1.widgetsInTemplate;_1.widgetsInTemplate=false;this._template=new dd.DomTemplate(_19);_1.widgetsInTemplate=old;}},{render:function $D1f_(_1d,_1e){if(this._parsed){var _1f=new dd.DomBuffer();this._template.render(_1d,_1f);var _20=cloneNode(_1f.getRootNode());var div=document.createElement("div");div.appendChild(_20);var _21=div.innerHTML;div.removeChild(_20);if(_21!=this._rendered){this._rendered=_21;if(this._dijit){this._dijit.destroyRecursive();}this._dijit=dojo.parser.instantiate([_20])[0];}}var _22=this._dijit.domNode;if(this._events){this._events._object=this._dijit;this._events.render(_1d,_1e);}if(this._attach){this._attach._object=this._dijit;this._attach.render(_1d,_1e);}return _1e.concat(_22);},unrender:function $D1g_(_23,_24){return _24.remove(this._dijit.domNode);},clone:function $D1h_(){return new this.constructor(this._node,this._parsed);}});dojo.mixin(_1,{widgetsInTemplate:true,dojoAttachPoint:function $D1i_(_25,_26){return new _1.AttachNode(_26.contents.slice(16).split(/\s*,\s*/));},dojoAttachEvent:function $D1j_(_27,_28){return new _1.EventNode(_28.contents.slice(16));},dojoType:function $D1k_(_29,_2a){var _2b=false;if(_2a.contents.slice(-7)==" parsed"){_2b=true;}var _2c=_2a.contents.slice(9);var _2d=_2b?_2c.slice(0,-7):_2c.toString();if(_1.widgetsInTemplate){var _2e=_29.swallowNode();_2e.setAttribute("dojoType",_2d);return new _1.DojoTypeNode(_2e,_2b);}return new dd.AttributeNode("dojoType",_2d);},on:function $D1l_(_2f,_30){var _31=_30.contents.split();return new _1.EventNode(_31[0]+":"+_31.slice(1).join(" "));}});dd.register.tags("dojox.dtl.contrib",{"dijit":["attr:dojoType","attr:dojoAttachPoint",["attr:attach","dojoAttachPoint"],"attr:dojoAttachEvent",[/(attr:)?on(click|key(up))/i,"on"]]});})();}