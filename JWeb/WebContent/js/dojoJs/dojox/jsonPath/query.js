/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.jsonPath.query"]){dojo._hasResource["dojox.jsonPath.query"]=true;dojo.provide("dojox.jsonPath.query");dojox.jsonPath.query=function $DAkW_(_1,_2,_3){var re=dojox.jsonPath._regularExpressions;if(!_3){_3={};}var _4=[];function _str(i){return _4[i];};var _5;if(_3.resultType=="PATH"&&_3.evalType=="RESULT"){throw Error("RESULT based evaluation not supported with PATH based results");}var P={resultType:_3.resultType||"VALUE",normalize:function $DAkR_(_6){var _7=[];_6=_6.replace(/'([^']|'')*'/g,function(t){return "_str("+(_4.push(eval(t))-1)+")";});var ll=-1;while(ll!=_7.length){ll=_7.length;_6=_6.replace(/(\??\([^\(\)]*\))/g,function($0){return "#"+(_7.push($0)-1);});}_6=_6.replace(/[\['](#[0-9]+)[\]']/g,"[$1]").replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"");ll=-1;while(ll!=_6){ll=_6;_6=_6.replace(/#([0-9]+)/g,function($0,$1){return _7[$1];});}return _6.split(";");},asPaths:function $DAkS_(_8){for(var j=0;j<_8.length;j++){var p="$";var x=_8[j];for(var i=1,n=x.length;i<n;i++){p+=/^[0-9*]+$/.test(x[i])?("["+x[i]+"]"):("['"+x[i]+"']");}_8[j]=p;}return _8;},exec:function $DAkT_(_9,_a,rb){var _b=["$"];var _c=rb?_a:[_a];var _d=[_b];function add(v,p,_e){if(v&&v.hasOwnProperty(p)&&P.resultType!="VALUE"){_d.push(_b.concat([p]));}if(_e){_c=v[p];}else{if(v&&v.hasOwnProperty(p)){_c.push(v[p]);}}};function desc(v){_c.push(v);_d.push(_b);P.walk(v,function(i){if(typeof v[i]==="object"){var _f=_b;_b=_b.concat(i);desc(v[i]);_b=_f;}});};function slice(loc,val){if(val instanceof Array){var len=val.length,_10=0,end=len,_11=1;loc.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function($0,$1,$2,$3){_10=parseInt($1||_10);end=parseInt($2||end);_11=parseInt($3||_11);});_10=(_10<0)?Math.max(0,_10+len):Math.min(len,_10);end=(end<0)?Math.max(0,end+len):Math.min(len,end);for(var i=_10;i<end;i+=_11){add(val,i);}}};function repStr(str){var i=loc.match(/^_str\(([0-9]+)\)$/);return i?_4[i[1]]:str;};function oper(val){if(/^\(.*?\)$/.test(loc)){add(val,P.eval(loc,val),rb);}else{if(loc==="*"){P.walk(val,rb&&val instanceof Array?function(i){P.walk(val[i],function(j){add(val[i],j);});}:function(i){add(val,i);});}else{if(loc===".."){desc(val);}else{if(/,/.test(loc)){for(var s=loc.split(/'?,'?/),i=0,n=s.length;i<n;i++){add(val,repStr(s[i]));}}else{if(/^\?\(.*?\)$/.test(loc)){P.walk(val,function(i){if(P.eval(loc.replace(/^\?\((.*?)\)$/,"$1"),val[i])){add(val,i);}});}else{if(/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(loc)){slice(loc,val);}else{loc=repStr(loc);if(rb&&val instanceof Array&&!/^[0-9*]+$/.test(loc)){P.walk(val,function(i){add(val[i],loc);});}else{add(val,loc,rb);}}}}}}}};while(_9.length){var loc=_9.shift();if((_a=_c)===null||_a===undefined){return _a;}_c=[];var _12=_d;_d=[];if(rb){oper(_a);}else{P.walk(_a,function(i){_b=_12[i]||_b;oper(_a[i]);});}}if(P.resultType=="BOTH"){_d=P.asPaths(_d);var _13=[];for(var i=0;i<_d.length;i++){_13.push({path:_d[i],value:_c[i]});}return _13;}return P.resultType=="PATH"?P.asPaths(_d):_c;},walk:function $DAkU_(val,f){if(val instanceof Array){for(var i=0,n=val.length;i<n;i++){if(i in val){f(i);}}}else{if(typeof val==="object"){for(var m in val){if(val.hasOwnProperty(m)){f(m);}}}}},eval:function $DAkV_(x,_14){try{return $&&_14&&eval(x.replace(/@/g,"_v"));}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"));}}};var $=_1;if(_2&&_1){return P.exec(P.normalize(_2).slice(1),_1,_3.evalType=="RESULT");}return false;};}