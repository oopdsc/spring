/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.secure.DOM"]){dojo._hasResource["dojox.secure.DOM"]=true;dojo.provide("dojox.secure.DOM");dojo.require("dojox.lang.observable");dojox.secure.DOM=function $DAq9_(_1){function safeNode(_2){if(!_2){return _2;}var _3=_2;do{if(_3==_1){return wrap(_2);}}while((_3=_3.parentNode));return null;};function wrap(_4){if(_4){if(_4.nodeType){var _5=_6(_4);if(_4.nodeType==1&&typeof _5.style=="function"){_5.style=_7(_4.style);_5.ownerDocument=_8;_5.childNodes={__get__:function(i){return wrap(_4.childNodes[i]);},length:0};}return _5;}if(_4&&typeof _4=="object"){if(_4.__observable){return _4.__observable;}_5=_4 instanceof Array?[]:{};_4.__observable=_5;for(var i in _4){if(i!="__observable"){_5[i]=wrap(_4[i]);}}_5.data__=_4;return _5;}if(typeof _4=="function"){var _9=function(_a){if(typeof _a=="function"){return function(){for(var i=0;i<arguments.length;i++){arguments[i]=wrap(arguments[i]);}return _9(_a.apply(wrap(this),arguments));};}return dojox.secure.unwrap(_a);};return function(){if(_4.safetyCheck){_4.safetyCheck.apply(_9(this),arguments);}for(var i=0;i<arguments.length;i++){arguments[i]=_9(arguments[i]);}return wrap(_4.apply(_9(this),arguments));};}}return _4;};unwrap=dojox.secure.unwrap;function safeCSS(_b){_b+="";if(_b.match(/behavior:|content:|javascript:|binding|expression|\@import/)){throw new Error("Illegal CSS");}var id=_1.id||(_1.id="safe"+(""+Math.random()).substring(2));return _b.replace(/(\}|^)\s*([^\{]*\{)/g,function(t,a,b){return a+" #"+id+" "+b;});};function safeURL(_c){if(_c.match(/:/)&&!_c.match(/^(http|ftp|mailto)/)){throw new Error("Unsafe URL "+_c);}};function safeElement(el){if(el&&el.nodeType==1){if(el.tagName.match(/script/i)){var _d=el.src;if(_d&&_d!=""){el.parentNode.removeChild(el);dojo.xhrGet({url:_d,secure:true}).addCallback(function(_e){_8.evaluate(_e);});}else{var _f=el.innerHTML;el.parentNode.removeChild(el);wrap.evaluate(_f);}}if(el.tagName.match(/link/i)){throw new Error("illegal tag");}if(el.tagName.match(/style/i)){var _10=function(_11){if(el.styleSheet){el.styleSheet.cssText=_11;}else{var _12=doc.createTextNode(_11);if(el.childNodes[0]){el.replaceChild(_12,el.childNodes[0]);}else{el.appendChild(_12);}}};_d=el.src;if(_d&&_d!=""){alert("src"+_d);el.src=null;dojo.xhrGet({url:_d,secure:true}).addCallback(function(_13){_10(safeCSS(_13));});}_10(safeCSS(el.innerHTML));}if(el.style){safeCSS(el.style.cssText);}if(el.href){safeURL(el.href);}if(el.src){safeURL(el.src);}var _14,i=0;while((_14=el.attributes[i++])){if(_14.name.substring(0,2)=="on"&&_14.value!="null"&&_14.value!=""){throw new Error("event handlers not allowed in the HTML, they must be set with element.addEventListener");}}var _15=el.childNodes;for(var i=0,l=_15.length;i<l;i++){safeElement(_15[i]);}}};function safeHTML(_16){var div=document.createElement("div");if(_16.match(/<object/i)){throw new Error("The object tag is not allowed");}div.innerHTML=_16;safeElement(div);return div;};var doc=_1.ownerDocument;var _8={getElementById:function $DAq2_(id){return safeNode(doc.getElementById(id));},createElement:function $DAq3_(_17){return wrap(doc.createElement(_17));},createTextNode:function $DAq4_(_18){return wrap(doc.createTextNode(_18));},write:function $DAq5_(str){var div=safeHTML(str);while(div.childNodes.length){_1.appendChild(div.childNodes[0]);}}};_8.open=_8.close=function(){};var _19={innerHTML:function $DAq6_(_1a,_1b){console.log("setting innerHTML");_1a.innerHTML=safeHTML(_1b).innerHTML;}};_19.outerHTML=function $DArA_(_1c,_1d){throw new Error("Can not set this property");};function domChanger(_1e,_1f){return function(_20,_21){safeElement(_21[_1f]);return _20[_1e](_21[0]);};};var _22={appendChild:domChanger("appendChild",0),insertBefore:domChanger("insertBefore",0),replaceChild:domChanger("replaceChild",1),cloneNode:function $DAq7_(_23,_24){return _23.cloneNode(_24[0]);},addEventListener:function $DAq8_(_25,_26){dojo.connect(_25,"on"+_26[0],this,function(_27){_27=_6(_27||window.event);_26[1].call(this,_27);});}};_22.childNodes=_22.style=_22.ownerDocument=function(){};function makeObserver(_28){return dojox.lang.makeObservable(function(_29,_2a){var _2b;return _29[_2a];},_28,function(_2c,_2d,_2e,_2f){for(var i=0;i<_2f.length;i++){_2f[i]=unwrap(_2f[i]);}if(_22[_2e]){return wrap(_22[_2e].call(_2c,_2d,_2f));}return wrap(_2d[_2e].apply(_2d,_2f));},_22);};var _6=makeObserver(function(_30,_31,_32){if(_19[_31]){_19[_31](_30,_32);}_30[_31]=_32;});var _33={behavior:1,MozBinding:1};var _7=makeObserver(function(_34,_35,_36){if(!_33[_35]){_34[_35]=safeCSS(_36);}});wrap.safeHTML=safeHTML;wrap.safeCSS=safeCSS;return wrap;};dojox.secure.unwrap=function unwrap(_37){return (_37&&_37.data__)||_37;};}