/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.rpc.Rest"]){dojo._hasResource["dojox.rpc.Rest"]=true;dojo.provide("dojox.rpc.Rest");(function(){if(dojox.rpc&&dojox.rpc.transportRegistry){dojox.rpc.transportRegistry.register("REST",function(_1){return _1=="REST";},{getExecutor:function $DAqh_(_2,_3,_4){return new dojox.rpc.Rest(_3.name,(_3.contentType||_4._smd.contentType||"").match(/json|javascript/),null,function(id,_5){var _6=_4._getRequest(_3,[id]);_6.url=_6.target+(_6.data?"?"+_6.data:"");return _6;});}});}var _7;function index(_8,_9,_a,id){_8.addCallback(function(_b){if(_8.ioArgs.xhr&&_a){_a=_8.ioArgs.xhr.getResponseHeader("Content-Range");_8.fullLength=_a&&(_a=_a.match(/\/(.*)/))&&parseInt(_a[1]);}return _b;});return _8;};_7=dojox.rpc.Rest=function(_c,_d,_e,_f){var _10;_10=function $DAqi_(id,_11){return _7._get(_10,id,_11);};_10.isJson=_d;_10._schema=_e;_10.cache={serialize:_d?((dojox.json&&dojox.json.ref)||dojo).toJson:function(_12){return _12;}};_10._getRequest=_f||function(id,_13){if(dojo.isObject(id)){id=dojo.objectToQuery(id);id=id?"?"+id:"";}if(_13&&_13.sort&&!_13.queryStr){id+=(id?"&":"?")+"sort(";for(var i=0;i<_13.sort.length;i++){var _14=_13.sort[i];id+=(i>0?",":"")+(_14.descending?"-":"+")+encodeURIComponent(_14.attribute);}id+=")";}var _15={url:_c+(id==null?"":id),handleAs:_d?"json":"text",contentType:_d?"application/json":"text/plain",sync:dojox.rpc._sync,headers:{Accept:_d?"application/json,application/javascript":"*/*"}};if(_13&&(_13.start>=0||_13.count>=0)){_15.headers.Range="items="+(_13.start||"0")+"-"+((_13.count&&_13.count!=Infinity&&(_13.count+(_13.start||0)-1))||"");}dojox.rpc._sync=false;return _15;};function makeRest(_16){_10[_16]=function(id,_17){return _7._change(_16,_10,id,_17);};};makeRest("put");makeRest("post");makeRest("delete");_10.servicePath=_c;return _10;};_7._index={};_7._timeStamps={};_7._change=function $DAqj_(_18,_19,id,_1a){var _1b=_19._getRequest(id);_1b[_18+"Data"]=_1a;return index(dojo.xhr(_18.toUpperCase(),_1b,true),_19);};_7._get=function $DAqk_(_1c,id,_1d){_1d=_1d||{};return index(dojo.xhrGet(_1c._getRequest(id,_1d)),_1c,(_1d.start>=0||_1d.count>=0),id);};})();}