/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.io.xhrMultiPart"]){dojo._hasResource["dojox.io.xhrMultiPart"]=true;dojo.provide("dojox.io.xhrMultiPart");dojo.require("dojox.uuid.generateRandomUuid");(function(){function _createPart(_1,_2){if(!_1["name"]&&!_1["content"]){throw new Error("Each part of a multi-part request requires 'name' and 'content'.");}var _3=[];_3.push("--"+_2,"Content-Disposition: form-data; name=\""+_1.name+"\""+(_1["filename"]?"; filename=\""+_1.filename+"\"":""));if(_1["contentType"]){var ct="Content-Type: "+_1.contentType;if(_1["charset"]){ct+="; Charset="+_1.charset;}_3.push(ct);}if(_1["contentTransferEncoding"]){_3.push("Content-Transfer-Encoding: "+_1.contentTransferEncoding);}_3.push("",_1.content);return _3;};function _partsFromNode(_4,_5){var o=dojo.formToObject(_4),_6=[];for(var p in o){if(dojo.isArray(o[p])){dojo.forEach(o[p],function(_7){_6=_6.concat(_createPart({name:p,content:_7},_5));});}else{_6=_6.concat(_createPart({name:p,content:o[p]},_5));}}return _6;};dojox.io.xhrMultiPart=function $DAjE_(_8){if(!_8["file"]&&!_8["content"]&&!_8["form"]){throw new Error("content, file or form must be provided to dojox.io.xhrMultiPart's arguments");}var _9=dojox.uuid.generateRandomUuid(),_a=[],_b="";if(_8["file"]||_8["content"]){var v=_8["file"]||_8["content"];dojo.forEach((dojo.isArray(v)?v:[v]),function(_c){_a=_a.concat(_createPart(_c,_9));});}else{if(_8["form"]){if(dojo.query("input[type=file]",_8["form"]).length){throw new Error("dojox.io.xhrMultiPart cannot post files that are values of an INPUT TYPE=FILE.  Use dojo.io.iframe.send() instead.");}_a=_partsFromNode(_8["form"],_9);}}if(_a.length){_a.push("--"+_9+"--","");_b=_a.join("\r\n");}console.log(_b);return dojo.rawXhrPost(dojo.mixin(_8,{contentType:"multipart/form-data; boundary="+_9,postData:_b}));};})();}