/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.data.util.JsonQuery"]){dojo._hasResource["dojox.data.util.JsonQuery"]=true;dojo.provide("dojox.data.util.JsonQuery");dojo.declare("dojox.data.util.JsonQuery",null,{useFullIdInQueries:false,_toJsonQuery:function $Drb_(_1,_2){var _3=true;var _4=this;function buildQuery(_5,_6){var _7=_6.__id;if(_7){var _8={};_8[_4.idAttribute]=_4.useFullIdInQueries?_6.__id:_6[_4.idAttribute];_6=_8;}for(var i in _6){var _9=_6[i];var _a=_5+(/^[a-zA-Z_][\w_]*$/.test(i)?"."+i:"["+dojo._escapeString(i)+"]");if(_9&&typeof _9=="object"){buildQuery(_a,_9);}else{if(_9!="*"){_b+=(_3?"":"&")+_a+((!_7&&typeof _9=="string"&&_1.queryOptions&&_1.queryOptions.ignoreCase)?"~":"=")+(_4.simplifiedQuery?encodeURIComponent(_9):dojo.toJson(_9));_3=false;}}}};if(_1.query&&typeof _1.query=="object"){var _b="[?(";buildQuery("@",_1.query);if(!_3){_b+=")]";}else{_b="";}_1.queryStr=_b.replace(/\\"|"/g,function(t){return t=="\""?"'":t;});}else{if(!_1.query||_1.query=="*"){_1.query="";}}var _c=_1.sort;if(_c){_1.queryStr=_1.queryStr||(typeof _1.query=="string"?_1.query:"");_3=true;for(i=0;i<_c.length;i++){_1.queryStr+=(_3?"[":",")+(_c[i].descending?"\\":"/")+"@["+dojo._escapeString(_c[i].attribute)+"]";_3=false;}if(!_3){_1.queryStr+="]";}}if(_2&&(_1.start||_1.count)){_1.queryStr=(_1.queryStr||(typeof _1.query=="string"?_1.query:""))+"["+(_1.start||"")+":"+(_1.count?(_1.start||0)+_1.count:"")+"]";}if(typeof _1.queryStr=="string"){_1.queryStr=_1.queryStr.replace(/\\"|"/g,function(t){return t=="\""?"'":t;});return _1.queryStr;}return _1.query;},jsonQueryPagination:true,fetch:function $Drc_(_d){this._toJsonQuery(_d,this.jsonQueryPagination);return this.inherited(arguments);},isUpdateable:function $Drd_(){return true;},matchesQuery:function $Dre_(_e,_f){_f._jsonQuery=_f._jsonQuery||dojox.json.query(this._toJsonQuery(_f));return _f._jsonQuery([_e]).length;},clientSideFetch:function $Drf_(_10,_11){_10._jsonQuery=_10._jsonQuery||dojox.json.query(this._toJsonQuery(_10));return this.clientSidePaging(_10,_10._jsonQuery(_11));},querySuperSet:function $Drg_(_12,_13){if(!_12.query){return _13.query;}return this.inherited(arguments);}});}