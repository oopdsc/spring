/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.json.query"]){dojo._hasResource["dojox.json.query"]=true;dojo.provide("dojox.json.query");(function(){function s(_1,_2,_3,_4){var _5=_1.length,_6=[];_3=_3||_5;_2=(_2<0)?Math.max(0,_2+_5):Math.min(_5,_2);_3=(_3<0)?Math.max(0,_3+_5):Math.min(_5,_3);for(var i=_2;i<_3;i+=_4){_6.push(_1[i]);}return _6;};function e(_7,_8){var _9=[];function walk(_a){if(_8){if(_8===true&&!(_a instanceof Array)){_9.push(_a);}else{if(_a[_8]){_9.push(_a[_8]);}}}for(var i in _a){var _b=_a[i];if(!_8){_9.push(_b);}else{if(_b&&typeof _b=="object"){walk(_b);}}}};if(_8 instanceof Array){if(_8.length==1){return _7[_8[0]];}for(var i=0;i<_8.length;i++){_9.push(_7[_8[i]]);}}else{walk(_7);}return _9;};function distinctFilter(_c,_d){var _e=[];var _f={};for(var i=0,l=_c.length;i<l;++i){var _10=_c[i];if(_d(_10,i,_c)){if((typeof _10=="object")&&_10){if(!_10.__included){_10.__included=true;_e.push(_10);}}else{if(!_f[_10+typeof _10]){_f[_10+typeof _10]=true;_e.push(_10);}}}}for(i=0,l=_e.length;i<l;++i){if(_e[i]){delete _e[i].__included;}}return _e;};dojox.json.query=function $DAkI_(_11,obj){var _12=0;var str=[];_11=_11.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(t){_12+=t=="["?1:t=="]"?-1:0;return (t=="]"&&_12>0)?"`]":(t.charAt(0)=="\""||t.charAt(0)=="'")?"`"+(str.push(t)-1):t;});var _13="";function call(_14){_13=_14+"("+_13;};function makeRegex(t,a,b,c,d,e,f,g){return str[g].match(/[\*\?]/)||f=="~"?"/^"+str[g].substring(1,str[g].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+(f=="~"?"$/i":"$/")+".test("+a+")":t;};_11.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw new Error("Unsafe function call");});_11=_11.replace(/([^=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(t){return t.charAt(0)=="."?t:t=="@"?"$obj":(t.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+t;}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(t,a,b){var _15=t.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/);if(_15){var _16="";if(t.match(/^\./)){call("e");_16=",true)";}call(_15[1].match(/\=/)?"dojo.map":_15[1].match(/\^/)?"distinctFilter":"dojo.filter");return _16+",function($obj){return "+_15[2]+"})";}_15=t.match(/^\[\s*([\/\\].*)\]/);if(_15){return ".concat().sort(function(a,b){"+_15[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(t,a,b){return "var av= "+b.replace(/\$obj/,"a")+",bv= "+b.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+(a=="/"?1:-1)+";}\n"+"if(bv>av||av==null){return "+(a=="/"?-1:1)+";}\n";})+"return 0;})";}_15=t.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/);if(_15){call("s");return ","+(_15[1]||0)+","+(_15[2]||0)+","+(_15[3]||1)+")";}if(t.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)){call("e");return (t.charAt(1)=="."?",'"+b+"'":t.match(/,/)?","+t:"")+")";}return t;}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,makeRegex).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(t,a,b,c,d,e,f,g){return makeRegex(t,c,d,e,f,g,b,a);});_11=_13+(_11.charAt(0)=="$"?"":"$")+_11.replace(/`([0-9]+|\])/g,function(t,a){return a=="]"?"]":str[a];});var _17=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+_11+"}");for(var i=0;i<arguments.length-1;i++){arguments[i]=arguments[i+1];}return obj?_17.apply(this,arguments):_17;};})();}