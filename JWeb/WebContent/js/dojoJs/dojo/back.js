/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.back"]){dojo._hasResource["dojo.back"]=true;dojo.provide("dojo.back");(function(){var _1=dojo.back;function getHash(){var h=window.location.hash;if(h.charAt(0)=="#"){h=h.substring(1);}return dojo.isMozilla?h:decodeURIComponent(h);};function setHash(h){if(!h){h="";}window.location.hash=encodeURIComponent(h);_2=history.length;};if(dojo.exists("tests.back-hash")){_1.getHash=getHash;_1.setHash=setHash;}var _3=(typeof (window)!=="undefined")?window.location.href:"";var _4=(typeof (window)!=="undefined")?getHash():"";var _5=null;var _6=null;var _7=null;var _8=null;var _9=[];var _a=[];var _b=false;var _c=false;var _2;function handleBackButton(){var _d=_a.pop();if(!_d){return;}var _e=_a[_a.length-1];if(!_e&&_a.length==0){_e=_5;}if(_e){if(_e.kwArgs["back"]){_e.kwArgs["back"]();}else{if(_e.kwArgs["backButton"]){_e.kwArgs["backButton"]();}else{if(_e.kwArgs["handle"]){_e.kwArgs.handle("back");}}}}_9.push(_d);};_1.goBack=handleBackButton;function handleForwardButton(){var _f=_9.pop();if(!_f){return;}if(_f.kwArgs["forward"]){_f.kwArgs.forward();}else{if(_f.kwArgs["forwardButton"]){_f.kwArgs.forwardButton();}else{if(_f.kwArgs["handle"]){_f.kwArgs.handle("forward");}}}_a.push(_f);};_1.goForward=handleForwardButton;function createState(url,_10,_11){return {"url":url,"kwArgs":_10,"urlHash":_11};};function getUrlQuery(url){var _12=url.split("?");if(_12.length<2){return null;}else{return _12[1];}};function loadIframeHistory(){var url=(dojo.config["dojoIframeHistoryUrl"]||dojo.moduleUrl("dojo","resources/iframe_history.html"))+"?"+(new Date()).getTime();_b=true;if(_8){dojo.isWebKit?_8.location=url:window.frames[_8.name].location=url;}else{}return url;};function checkLocation(){if(!_c){var hsl=_a.length;var _13=getHash();if((_13===_4||window.location.href==_3)&&(hsl==1)){handleBackButton();return;}if(_9.length>0){if(_9[_9.length-1].urlHash===_13){handleForwardButton();return;}}if((hsl>=2)&&(_a[hsl-2])){if(_a[hsl-2].urlHash===_13){handleBackButton();return;}}if(dojo.isSafari&&dojo.isSafari<3){var _14=history.length;if(_14>_2){handleForwardButton();}else{if(_14<_2){handleBackButton();}}_2=_14;}}};_1.init=function $DBBn_(){if(dojo.byId("dj_history")){return;}var src=dojo.config["dojoIframeHistoryUrl"]||dojo.moduleUrl("dojo","resources/iframe_history.html");if(dojo._postLoad){console.error("dojo.back.init() must be called before the DOM has loaded. "+"If using xdomain loading or djConfig.debugAtAllCosts, include dojo.back "+"in a build layer.");}else{document.write("<iframe style=\"border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;\" name=\"dj_history\" id=\"dj_history\" src=\""+src+"\"></iframe>");}};_1.setInitialState=function $DBBo_(_15){_5=createState(_3,_15,_4);};_1.addToHistory=function $DBBq_(_16){_9=[];var _17=null;var url=null;if(!_8){if(dojo.config["useXDomain"]&&!dojo.config["dojoIframeHistoryUrl"]){console.warn("dojo.back: When using cross-domain Dojo builds,"+" please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl"+" to the path on your domain to iframe_history.html");}_8=window.frames["dj_history"];}if(!_7){_7=dojo.create("a",{style:{display:"none"}},dojo.body());}if(_16["changeUrl"]){_17=""+((_16["changeUrl"]!==true)?_16["changeUrl"]:(new Date()).getTime());if(_a.length==0&&_5.urlHash==_17){_5=createState(url,_16,_17);return;}else{if(_a.length>0&&_a[_a.length-1].urlHash==_17){_a[_a.length-1]=createState(url,_16,_17);return;}}_c=true;setTimeout(function(){setHash(_17);_c=false;},1);_7.href=_17;if(dojo.isIE){url=loadIframeHistory();var _18=_16["back"]||_16["backButton"]||_16["handle"];var tcb=function(_19){if(getHash()!=""){setTimeout(function(){setHash(_17);},1);}_18.apply(this,[_19]);};if(_16["back"]){_16.back=tcb;}else{if(_16["backButton"]){_16.backButton=tcb;}else{if(_16["handle"]){_16.handle=tcb;}}}var _1a=_16["forward"]||_16["forwardButton"]||_16["handle"];var tfw=function(_1b){if(getHash()!=""){setHash(_17);}if(_1a){_1a.apply(this,[_1b]);}};if(_16["forward"]){_16.forward=tfw;}else{if(_16["forwardButton"]){_16.forwardButton=tfw;}else{if(_16["handle"]){_16.handle=tfw;}}}}else{if(!dojo.isIE){if(!_6){_6=setInterval(checkLocation,200);}}}}else{url=loadIframeHistory();}_a.push(createState(url,_16,_17));};_1._iframeLoaded=function $DBBr_(evt,_1c){var _1d=getUrlQuery(_1c.href);if(_1d==null){if(_a.length==1){handleBackButton();}return;}if(_b){_b=false;return;}if(_a.length>=2&&_1d==getUrlQuery(_a[_a.length-2].url)){handleBackButton();}else{if(_9.length>0&&_1d==getUrlQuery(_9[_9.length-1].url)){handleForwardButton();}}};})();}