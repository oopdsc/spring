/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.Tree"]){dojo._hasResource["dijit.Tree"]=true;dojo.provide("dijit.Tree");dojo.require("dojo.fx");dojo.require("dojo.DeferredList");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Container");dojo.require("dijit._Contained");dojo.require("dojo.cookie");dojo.declare("dijit._TreeNode",[dijit._Widget,dijit._Templated,dijit._Container,dijit._Contained],{item:null,isTreeNode:true,label:"",isExpandable:null,isExpanded:false,state:"UNCHECKED",templateString:dojo.cache("dijit","templates/TreeNode.html","<div class=\"dijitTreeNode\" waiRole=\"presentation\"\r\n\t><div dojoAttachPoint=\"rowNode\" class=\"dijitTreeRow\" waiRole=\"presentation\" dojoAttachEvent=\"onmouseenter:_onMouseEnter, onmouseleave:_onMouseLeave, onclick:_onClick, ondblclick:_onDblClick\"\r\n\t\t><img src=\"${_blankGif}\" alt=\"\" dojoAttachPoint=\"expandoNode\" class=\"dijitTreeExpando\" waiRole=\"presentation\"\r\n\t\t><span dojoAttachPoint=\"expandoNodeText\" class=\"dijitExpandoText\" waiRole=\"presentation\"\r\n\t\t></span\r\n\t\t><span dojoAttachPoint=\"contentNode\"\r\n\t\t\tclass=\"dijitTreeContent\" waiRole=\"presentation\">\r\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" dojoAttachPoint=\"iconNode\" class=\"dijitTreeIcon\" waiRole=\"presentation\"\r\n\t\t\t><span dojoAttachPoint=\"labelNode\" class=\"dijitTreeLabel\" wairole=\"treeitem\" tabindex=\"-1\" waiState=\"selected-false\" dojoAttachEvent=\"onfocus:_onLabelFocus, onblur:_onLabelBlur\"></span>\r\n\t\t</span\r\n\t></div>\r\n\t<div dojoAttachPoint=\"containerNode\" class=\"dijitTreeContainer\" waiRole=\"presentation\" style=\"display: none;\"></div>\r\n</div>\r\n"),attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{label:{node:"labelNode",type:"innerText"},tooltip:{node:"rowNode",type:"attribute",attribute:"title"}}),postCreate:function $DN2_(){this._setExpando();this._updateItemClasses(this.item);if(this.isExpandable){dijit.setWaiState(this.labelNode,"expanded",this.isExpanded);}},_setIndentAttr:function $DN3_(_1){this.indent=_1;var _2=(Math.max(_1,0)*this.tree._nodePixelIndent)+"px";dojo.style(this.domNode,"backgroundPosition",_2+" 0px");dojo.style(this.rowNode,dojo._isBodyLtr()?"paddingLeft":"paddingRight",_2);dojo.forEach(this.getChildren(),function(_3){_3.attr("indent",_1+1);});},markProcessing:function $DN4_(){this.state="LOADING";this._setExpando(true);},unmarkProcessing:function $DN5_(){this._setExpando(false);},_updateItemClasses:function $DN6_(_4){var _5=this.tree,_6=_5.model;if(_5._v10Compat&&_4===_6.root){_4=null;}this._applyClassAndStyle(_4,"icon","Icon");this._applyClassAndStyle(_4,"label","Label");this._applyClassAndStyle(_4,"row","Row");},_applyClassAndStyle:function $DN7_(_7,_8,_9){var _a="_"+_8+"Class";var _b=_8+"Node";if(this[_a]){dojo.removeClass(this[_b],this[_a]);}this[_a]=this.tree["get"+_9+"Class"](_7,this.isExpanded);if(this[_a]){dojo.addClass(this[_b],this[_a]);}dojo.style(this[_b],this.tree["get"+_9+"Style"](_7,this.isExpanded)||{});},_updateLayout:function $DN8_(){var _c=this.getParent();if(!_c||_c.rowNode.style.display=="none"){dojo.addClass(this.domNode,"dijitTreeIsRoot");}else{dojo.toggleClass(this.domNode,"dijitTreeIsLast",!this.getNextSibling());}},_setExpando:function $DN9_(_d){var _e=["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"],_f=["*","-","+","*"],idx=_d?0:(this.isExpandable?(this.isExpanded?1:2):3);dojo.removeClass(this.expandoNode,_e);dojo.addClass(this.expandoNode,_e[idx]);this.expandoNodeText.innerHTML=_f[idx];},expand:function $DOA_(){if(this._expandDeferred){return this._expandDeferred;}this._wipeOut&&this._wipeOut.stop();this.isExpanded=true;dijit.setWaiState(this.labelNode,"expanded","true");dijit.setWaiRole(this.containerNode,"group");dojo.addClass(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);if(this==this.tree.rootNode){dijit.setWaiState(this.tree.domNode,"expanded","true");}var def,_10=dojo.fx.wipeIn({node:this.containerNode,duration:dijit.defaultDuration,onEnd:function $DOB_(){def.callback(true);}});def=(this._expandDeferred=new dojo.Deferred(function(){_10.stop();}));_10.play();return def;},collapse:function $DOC_(){if(!this.isExpanded){return;}if(this._expandDeferred){this._expandDeferred.cancel();delete this._expandDeferred;}this.isExpanded=false;dijit.setWaiState(this.labelNode,"expanded","false");if(this==this.tree.rootNode){dijit.setWaiState(this.tree.domNode,"expanded","false");}dojo.removeClass(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);if(!this._wipeOut){this._wipeOut=dojo.fx.wipeOut({node:this.containerNode,duration:dijit.defaultDuration});}this._wipeOut.play();},indent:0,setChildItems:function $DOD_(_11){var _12=this.tree,_13=_12.model,_14=[];this.getChildren().forEach(function(_15){dijit._Container.prototype.removeChild.call(this,_15);},this);this.state="LOADED";if(_11&&_11.length>0){this.isExpandable=true;dojo.forEach(_11,function(_16){var id=_13.getIdentity(_16),_17=_12._itemNodesMap[id],_18;if(_17){for(var i=0;i<_17.length;i++){if(_17[i]&&!_17[i].getParent()){_18=_17[i];_18.attr("indent",this.indent+1);break;}}}if(!_18){_18=this.tree._createTreeNode({item:_16,tree:_12,isExpandable:_13.mayHaveChildren(_16),label:_12.getLabel(_16),tooltip:_12.getTooltip(_16),indent:this.indent+1});if(_17){_17.push(_18);}else{_12._itemNodesMap[id]=[_18];}}this.addChild(_18);if(this.tree.autoExpand||this.tree._state(_16)){_14.push(_12._expandNode(_18));}},this);dojo.forEach(this.getChildren(),function(_19,idx){_19._updateLayout();});}else{this.isExpandable=false;}if(this._setExpando){this._setExpando(false);}if(this==_12.rootNode){var fc=this.tree.showRoot?this:this.getChildren()[0];if(fc){fc.setSelected(true);_12.lastFocused=fc;}else{_12.domNode.setAttribute("tabIndex","0");}}return new dojo.DeferredList(_14);},removeChild:function $DOE_(_1a){this.inherited(arguments);var _1b=this.getChildren();if(_1b.length==0){this.isExpandable=false;this.collapse();}dojo.forEach(_1b,function(_1c){_1c._updateLayout();});},makeExpandable:function $DOF_(){this.isExpandable=true;this._setExpando(false);},_onLabelFocus:function $DOG_(evt){dojo.addClass(this.labelNode,"dijitTreeLabelFocused");this.tree._onNodeFocus(this);},_onLabelBlur:function $DOH_(evt){dojo.removeClass(this.labelNode,"dijitTreeLabelFocused");},setSelected:function $DOI_(_1d){var _1e=this.labelNode;_1e.setAttribute("tabIndex",_1d?"0":"-1");dijit.setWaiState(_1e,"selected",_1d);dojo.toggleClass(this.rowNode,"dijitTreeNodeSelected",_1d);},_onClick:function $DOJ_(evt){this.tree._onClick(this,evt);},_onDblClick:function $DOK_(evt){this.tree._onDblClick(this,evt);},_onMouseEnter:function $DOL_(evt){dojo.addClass(this.rowNode,"dijitTreeNodeHover");this.tree._onNodeMouseEnter(this,evt);},_onMouseLeave:function $DOM_(evt){dojo.removeClass(this.rowNode,"dijitTreeNodeHover");this.tree._onNodeMouseLeave(this,evt);}});dojo.declare("dijit.Tree",[dijit._Widget,dijit._Templated],{store:null,model:null,query:null,label:"",showRoot:true,childrenAttr:["children"],path:[],selectedItem:null,openOnClick:false,openOnDblClick:false,templateString:dojo.cache("dijit","templates/Tree.html","<div class=\"dijitTree dijitTreeContainer\" waiRole=\"tree\"\r\n\tdojoAttachEvent=\"onkeypress:_onKeyPress\">\r\n\t<div class=\"dijitInline dijitTreeIndent\" style=\"position: absolute; top: -9999px\" dojoAttachPoint=\"indentDetector\"></div>\r\n</div>\r\n"),persist:true,autoExpand:false,dndController:null,dndParams:["onDndDrop","itemCreator","onDndCancel","checkAcceptance","checkItemAcceptance","dragThreshold","betweenThreshold"],onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function $DOQ_(_1f,_20){dojo.publish(this.id,[dojo.mixin({tree:this,event:_1f},_20||{})]);},postMixInProperties:function $DOR_(){this.tree=this;this._itemNodesMap={};if(!this.cookieName){this.cookieName=this.id+"SaveStateCookie";}this._loadDeferred=new dojo.Deferred();this.inherited(arguments);},postCreate:function $DOS_(){this._initState();if(!this.model){this._store2model();}this.connect(this.model,"onChange","_onItemChange");this.connect(this.model,"onChildrenChange","_onItemChildrenChange");this.connect(this.model,"onDelete","_onItemDelete");this._load();this.inherited(arguments);if(this.dndController){if(dojo.isString(this.dndController)){this.dndController=dojo.getObject(this.dndController);}var _21={};for(var i=0;i<this.dndParams.length;i++){if(this[this.dndParams[i]]){_21[this.dndParams[i]]=this[this.dndParams[i]];}}this.dndController=new this.dndController(this,_21);}},_store2model:function $DOT_(){this._v10Compat=true;dojo.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var _22={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};if(this.params.mayHaveChildren){_22.mayHaveChildren=dojo.hitch(this,"mayHaveChildren");}if(this.params.getItemChildren){_22.getChildren=dojo.hitch(this,function(_23,_24,_25){this.getItemChildren((this._v10Compat&&_23===this.model.root)?null:_23,_24,_25);});}this.model=new dijit.tree.ForestStoreModel(_22);this.showRoot=Boolean(this.label);},onLoad:function $DOU_(){},_load:function $DOV_(){this.model.getRoot(dojo.hitch(this,function(_26){var rn=(this.rootNode=this.tree._createTreeNode({item:_26,tree:this,isExpandable:true,label:this.label||this.getLabel(_26),indent:this.showRoot?0:-1}));if(!this.showRoot){rn.rowNode.style.display="none";}this.domNode.appendChild(rn.domNode);var _27=this.model.getIdentity(_26);if(this._itemNodesMap[_27]){this._itemNodesMap[_27].push(rn);}else{this._itemNodesMap[_27]=[rn];}rn._updateLayout();this._expandNode(rn).addCallback(dojo.hitch(this,function(){this._loadDeferred.callback(true);this.onLoad();}));}),function(err){console.error(this,": error loading root: ",err);});},getNodesByItem:function $DOW_(_28){if(!_28){return [];}var _29=dojo.isString(_28)?_28:this.model.getIdentity(_28);return [].concat(this._itemNodesMap[_29]);},_setSelectedItemAttr:function $DOX_(_2a){var _2b=this.attr("selectedItem");var _2c=(!_2a||dojo.isString(_2a))?_2a:this.model.getIdentity(_2a);if(_2c==_2b?this.model.getIdentity(_2b):null){return;}var _2d=this._itemNodesMap[_2c];if(_2d&&_2d.length){this.focusNode(_2d[0]);}else{if(this.lastFocused){this.lastFocused.setSelected(false);this.lastFocused=null;}}},_getSelectedItemAttr:function $DOY_(){return this.lastFocused&&this.lastFocused.item;},_setPathAttr:function $DOZ_(_2e){if(!_2e||!_2e.length){return;}this._loadDeferred.addCallback(dojo.hitch(this,function(){if(!this.rootNode){console.debug("!this.rootNode");return;}if(_2e[0]!==this.rootNode.item&&(dojo.isString(_2e[0])&&_2e[0]!=this.model.getIdentity(this.rootNode.item))){console.error(this,":path[0] doesn't match this.rootNode.item.  Maybe you are using the wrong tree.");return;}_2e.shift();var _2f=this.rootNode;function advance(){var _30=_2e.shift(),_31=dojo.isString(_30)?_30:this.model.getIdentity(_30);dojo.some(this._itemNodesMap[_31],function(n){if(n.getParent()==_2f){_2f=n;return true;}return false;});if(_2e.length){this._expandNode(_2f).addCallback(dojo.hitch(this,advance));}else{if(this.lastFocused!=_2f){this.focusNode(_2f);}}};this._expandNode(_2f).addCallback(dojo.hitch(this,advance));}));},_getPathAttr:function $DOa_(){if(!this.lastFocused){return;}var res=[];var _32=this.lastFocused;while(_32&&_32!==this.rootNode){res.unshift(_32.item);_32=_32.getParent();}res.unshift(this.rootNode.item);return res;},mayHaveChildren:function $DOb_(_33){},getItemChildren:function $DOc_(_34,_35){},getLabel:function $DOd_(_36){return this.model.getLabel(_36);},getIconClass:function $DOe_(_37,_38){return (!_37||this.model.mayHaveChildren(_37))?(_38?"dijitFolderOpened":"dijitFolderClosed"):"dijitLeaf";},getLabelClass:function $DOf_(_39,_3a){},getRowClass:function $DOg_(_3b,_3c){},getIconStyle:function $DOh_(_3d,_3e){},getLabelStyle:function $DOi_(_3f,_40){},getRowStyle:function $DOj_(_41,_42){},getTooltip:function $DOk_(_43){return "";},_onKeyPress:function $DOl_(e){if(e.altKey){return;}var dk=dojo.keys;var _44=dijit.getEnclosingWidget(e.target);if(!_44){return;}var key=e.charOrCode;if(typeof key=="string"){if(!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey){this._onLetterKeyNav({node:_44,key:key.toLowerCase()});dojo.stopEvent(e);}}else{if(this._curSearch){clearTimeout(this._curSearch.timer);delete this._curSearch;}var map=this._keyHandlerMap;if(!map){map={};map[dk.ENTER]="_onEnterKey";map[this.isLeftToRight()?dk.LEFT_ARROW:dk.RIGHT_ARROW]="_onLeftArrow";map[this.isLeftToRight()?dk.RIGHT_ARROW:dk.LEFT_ARROW]="_onRightArrow";map[dk.UP_ARROW]="_onUpArrow";map[dk.DOWN_ARROW]="_onDownArrow";map[dk.HOME]="_onHomeKey";map[dk.END]="_onEndKey";this._keyHandlerMap=map;}if(this._keyHandlerMap[key]){this[this._keyHandlerMap[key]]({node:_44,item:_44.item,evt:e});dojo.stopEvent(e);}}},_onEnterKey:function $DOm_(_45,evt){this._publish("execute",{item:_45.item,node:_45.node});this.onClick(_45.item,_45.node,evt);},_onDownArrow:function $DOn_(_46){var _47=this._getNextNode(_46.node);if(_47&&_47.isTreeNode){this.focusNode(_47);}},_onUpArrow:function $DOo_(_48){var _49=_48.node;var _4a=_49.getPreviousSibling();if(_4a){_49=_4a;while(_49.isExpandable&&_49.isExpanded&&_49.hasChildren()){var _4b=_49.getChildren();_49=_4b[_4b.length-1];}}else{var _4c=_49.getParent();if(!(!this.showRoot&&_4c===this.rootNode)){_49=_4c;}}if(_49&&_49.isTreeNode){this.focusNode(_49);}},_onRightArrow:function $DOp_(_4d){var _4e=_4d.node;if(_4e.isExpandable&&!_4e.isExpanded){this._expandNode(_4e);}else{if(_4e.hasChildren()){_4e=_4e.getChildren()[0];if(_4e&&_4e.isTreeNode){this.focusNode(_4e);}}}},_onLeftArrow:function $DOq_(_4f){var _50=_4f.node;if(_50.isExpandable&&_50.isExpanded){this._collapseNode(_50);}else{var _51=_50.getParent();if(_51&&_51.isTreeNode&&!(!this.showRoot&&_51===this.rootNode)){this.focusNode(_51);}}},_onHomeKey:function $DOr_(){var _52=this._getRootOrFirstNode();if(_52){this.focusNode(_52);}},_onEndKey:function $DOs_(_53){var _54=this.rootNode;while(_54.isExpanded){var c=_54.getChildren();_54=c[c.length-1];}if(_54&&_54.isTreeNode){this.focusNode(_54);}},multiCharSearchDuration:250,_onLetterKeyNav:function $DOt_(_55){var cs=this._curSearch;if(cs){cs.pattern=cs.pattern+_55.key;clearTimeout(cs.timer);}else{cs=this._curSearch={pattern:_55.key,startNode:_55.node};}var _56=this;cs.timer=setTimeout(function(){delete _56._curSearch;},this.multiCharSearchDuration);var _57=cs.startNode;do{_57=this._getNextNode(_57);if(!_57){_57=this._getRootOrFirstNode();}}while(_57!==cs.startNode&&(_57.label.toLowerCase().substr(0,cs.pattern.length)!=cs.pattern));if(_57&&_57.isTreeNode){if(_57!==cs.startNode){this.focusNode(_57);}}},_onClick:function $DOu_(_58,e){var _59=e.target;if((this.openOnClick&&_58.isExpandable)||(_59==_58.expandoNode||_59==_58.expandoNodeText)){if(_58.isExpandable){this._onExpandoClick({node:_58});}}else{this._publish("execute",{item:_58.item,node:_58,evt:e});this.onClick(_58.item,_58,e);this.focusNode(_58);}dojo.stopEvent(e);},_onDblClick:function $DOv_(_5a,e){var _5b=e.target;if((this.openOnDblClick&&_5a.isExpandable)||(_5b==_5a.expandoNode||_5b==_5a.expandoNodeText)){if(_5a.isExpandable){this._onExpandoClick({node:_5a});}}else{this._publish("execute",{item:_5a.item,node:_5a,evt:e});this.onDblClick(_5a.item,_5a,e);this.focusNode(_5a);}dojo.stopEvent(e);},_onExpandoClick:function $DOw_(_5c){var _5d=_5c.node;this.focusNode(_5d);if(_5d.isExpanded){this._collapseNode(_5d);}else{this._expandNode(_5d);}},onClick:function $DOx_(_5e,_5f,evt){},onDblClick:function $DOy_(_60,_61,evt){},onOpen:function $DOz_(_62,_63){},onClose:function $DO0_(_64,_65){},_getNextNode:function $DO1_(_66){if(_66.isExpandable&&_66.isExpanded&&_66.hasChildren()){return _66.getChildren()[0];}else{while(_66&&_66.isTreeNode){var _67=_66.getNextSibling();if(_67){return _67;}_66=_66.getParent();}return null;}},_getRootOrFirstNode:function $DO2_(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0];},_collapseNode:function $DO3_(_68){if(_68._expandNodeDeferred){delete _68._expandNodeDeferred;}if(_68.isExpandable){if(_68.state=="LOADING"){return;}_68.collapse();this.onClose(_68.item,_68);if(_68.item){this._state(_68.item,false);this._saveState();}}},_expandNode:function $DO4_(_69,_6a){if(_69._expandNodeDeferred&&!_6a){return _69._expandNodeDeferred;}var _6b=this.model,_6c=_69.item,_6d=this;switch(_69.state){case "UNCHECKED":_69.markProcessing();var def=(_69._expandNodeDeferred=new dojo.Deferred());_6b.getChildren(_6c,function(_6e){_69.unmarkProcessing();var _6f=_69.setChildItems(_6e);var ed=_6d._expandNode(_69,true);_6f.addCallback(function(){ed.addCallback(function(){def.callback();});});},function(err){console.error(_6d,": error loading root children: ",err);});break;default:def=(_69._expandNodeDeferred=_69.expand());this.onOpen(_69.item,_69);if(_6c){this._state(_6c,true);this._saveState();}}return def;},focusNode:function $DO5_(_70){dijit.focus(_70.labelNode);},_onNodeFocus:function $DO6_(_71){if(_71){if(_71!=this.lastFocused&&this.lastFocused&&!this.lastFocused._destroyed){this.lastFocused.setSelected(false);}_71.setSelected(true);this.lastFocused=_71;}},_onNodeMouseEnter:function $DO7_(_72){},_onNodeMouseLeave:function $DO8_(_73){},_onItemChange:function $DO9_(_74){var _75=this.model,_76=_75.getIdentity(_74),_77=this._itemNodesMap[_76];if(_77){var _78=this;dojo.forEach(_77,function(_79){_79.attr({label:_78.getLabel(_74),tooltip:_78.getTooltip(_74)});_79._updateItemClasses(_74);});}},_onItemChildrenChange:function $DPA_(_7a,_7b){var _7c=this.model,_7d=_7c.getIdentity(_7a),_7e=this._itemNodesMap[_7d];if(_7e){dojo.forEach(_7e,function(_7f){_7f.setChildItems(_7b);});}},_onItemDelete:function $DPB_(_80){var _81=this.model,_82=_81.getIdentity(_80),_83=this._itemNodesMap[_82];if(_83){dojo.forEach(_83,function(_84){var _85=_84.getParent();if(_85){_85.removeChild(_84);}_84.destroyRecursive();});delete this._itemNodesMap[_82];}},_initState:function $DPC_(){if(this.persist){var _86=dojo.cookie(this.cookieName);this._openedItemIds={};if(_86){dojo.forEach(_86.split(","),function(_87){this._openedItemIds[_87]=true;},this);}}},_state:function $DPD_(_88,_89){if(!this.persist){return false;}var id=this.model.getIdentity(_88);if(arguments.length===1){return this._openedItemIds[id];}if(_89){this._openedItemIds[id]=true;}else{delete this._openedItemIds[id];}},_saveState:function $DPE_(){if(!this.persist){return;}var ary=[];for(var id in this._openedItemIds){ary.push(id);}dojo.cookie(this.cookieName,ary.join(","),{expires:365});},destroy:function $DPF_(){if(this._curSearch){clearTimeout(this._curSearch.timer);delete this._curSearch;}if(this.rootNode){this.rootNode.destroyRecursive();}if(this.dndController&&!dojo.isString(this.dndController)){this.dndController.destroy();}this.rootNode=null;this.inherited(arguments);},destroyRecursive:function $DPG_(){this.destroy();},resize:function $DPH_(_8a){if(_8a){dojo.marginBox(this.domNode,_8a);dojo.style(this.domNode,"overflow","auto");}this._nodePixelIndent=dojo.marginBox(this.tree.indentDetector).w;if(this.tree.rootNode){this.tree.rootNode.attr("indent",this.showRoot?0:-1);}},_createTreeNode:function $DPI_(_8b){return new dijit._TreeNode(_8b);}});dojo.require("dijit.tree.TreeStoreModel");dojo.require("dijit.tree.ForestStoreModel");}